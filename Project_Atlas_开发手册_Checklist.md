# Project Atlas 开发手册 — 分阶段 Checklist

> 本手册将规划书中的所有功能拆解为可执行的开发任务清单，按三个阶段（Phase）组织。  
> 每个任务标注优先级（P0=必须/P1=重要/P2=增强）和前置依赖。  
> 开发时按顺序勾选，完成一项打一个 ✅。

---

## Phase 1：核心构建 (The Foundation)

**阶段目标：** 博主可使用 AI 生成并发布"可交互攻略"，粉丝可浏览行程

---

### 1.1 项目基础设施搭建

- [ ] **P0** 初始化前端项目（Vue 3 + Vite）
- [ ] **P0** 初始化后端项目（Flask 或 FastAPI）
- [ ] **P0** 搭建 PostgreSQL + PostGIS 数据库
- [ ] **P0** 配置开发环境（ESLint、Prettier、热重载）
- [ ] **P0** 前后端联调基础通信（API 约定、CORS 配置）
- [ ] **P1** 配置 Cloudflare Tunnel 本地部署方案
- [ ] **P1** 静态资源存储方案（本地磁盘 + 预留 OSS 接口）
- [ ] **P1** 全站 HTTPS 配置（通过 Cloudflare Tunnel）

---

### 1.2 用户系统

> 前置依赖：1.1 项目基础设施

- [ ] **P0** 数据库设计：用户表（id、手机号哈希、昵称、头像、注册时间、角色）
- [ ] **P0** 手机号 + 短信验证码注册/登录接口
- [ ] **P0** JWT Token 认证机制
- [ ] **P0** 登录/注册页面 UI
- [ ] **P0** 用户信息存储安全（bcrypt 加盐哈希手机号）
- [ ] **P1** 用户个人资料编辑（昵称、头像上传）
- [ ] **P1** 隐私协议弹窗（首次登录时展示，符合《个人信息保护法》）
- [ ] **P2** 微信扫码登录（可选）

---

### 1.3 POI 数据库与数据模型

> 前置依赖：1.1 数据库搭建

- [ ] **P0** 数据库设计：POI 表（id、名称、类型、坐标 PostGIS Point、地址、营业时间、门票价格、父级POI_id）
- [ ] **P0** 数据库设计：行程表（id、标题、目的地、天数、创建者、创建时间、状态[草稿/已发布]、可见性）
- [ ] **P0** 数据库设计：行程节点表（id、行程id、天次、序号、POI_id、开始时间、时长、费用、备注/Tips）
- [ ] **P0** POI 增删改查 API
- [ ] **P0** 行程增删改查 API
- [ ] **P1** POI 层级结构支持（城市 → 景区 → 子景点）
- [ ] **P1** POI 搜索接口（按名称、类型、坐标范围）
- [ ] **P2** 批量导入 POI 数据工具

---

### 1.4 地图引擎

> 前置依赖：1.1 前端项目、1.3 POI 数据

- [ ] **P0** 接入高德地图 JS API（申请 Key、初始化地图组件）
- [ ] **P0** 地图缩放、拖拽、基础交互
- [ ] **P0** 地图打点：在地图上显示行程中的 POI 标记
- [ ] **P0** 点击地图标记弹出 POI 信息卡片
- [ ] **P1** 路径连线：相邻 POI 之间绘制连线
- [ ] **P1** 接入高德路线规划 API（驾车/公交/步行距离与时间）
- [ ] **P1** 接入高德 POI 搜索 API（搜索地点并返回坐标）
- [ ] **P2** 地图自定义样式（配色方案匹配平台风格）

---

### 1.5 时间轴编辑器

> 前置依赖：1.4 地图引擎、1.3 数据模型

- [ ] **P0** 时间轴 UI 组件：按天分组的横向/纵向时间轴
- [ ] **P0** 时间块（Block）组件：显示 POI 名称、时间、时长
- [ ] **P0** 拖拽排序：时间块支持拖拽调整顺序（HTML5 Drag & Drop 或库）
- [ ] **P0** 地图 ↔ 时间轴联动：点击时间块高亮地图对应标记，反之亦然
- [ ] **P0** 添加/删除时间块
- [ ] **P1** 交通连接块：两个 POI 之间自动生成灰色交通块，显示时间估算
- [ ] **P1** 时间自动计算：根据到达时间 + 停留时长自动推算后续节点时间
- [ ] **P1** 每个时间块的费用标注字段
- [ ] **P1** 预算汇总面板：按日/按类别/总计实时显示
- [ ] **P2** 营业时间校验：不合理安排泛红预警
- [ ] **P2** 多日切换 Tab

---

### 1.6 AI 内容引擎

> 前置依赖：1.3 数据模型、1.5 时间轴

- [ ] **P0** 后端：DeepSeek API 接入与封装（API Key 管理、请求/响应处理）
- [ ] **P0** 后端：设计 System Prompt（输入游记文字 → 输出结构化 JSON）
- [ ] **P0** 后端：AI 返回结果解析与校验（JSON Schema 验证）
- [ ] **P0** 后端：AI 返回的地点名称自动调用高德 POI 搜索 API 匹配坐标
- [ ] **P0** 前端：文字粘贴输入界面（大文本框 + "一键生成"按钮）
- [ ] **P0** 前端：AI 生成中的加载状态/进度提示
- [ ] **P0** 前端：AI 结果预览 → 确认后导入时间轴编辑器
- [ ] **P1** 备选 API 接入（通义千问/GLM-4 作为 fallback）
- [ ] **P1** AI 生成历史记录（避免重复调用消耗额度）
- [ ] **P2** AI 结果手动微调界面（在导入前逐项修改）

---

### 1.7 基础 Dashboard（探索广场）

> 前置依赖：1.2 用户系统、1.3 行程数据

- [ ] **P0** 首页布局框架（响应式，PC + 移动端适配）
- [ ] **P0** 行程卡片流组件（展示标题、目的地、天数、封面图、作者）
- [ ] **P0** 已发布行程的公开浏览页面
- [ ] **P0** "我的行程"面板（草稿箱 / 已发布 / 进行中）
- [ ] **P1** 行程详情页（只读模式：地图 + 时间轴展示 + 费用汇总）
- [ ] **P1** 导航栏与路由系统（首页/编辑器/我的/设置）
- [ ] **P2** 简单的行程搜索（按目的地、关键词）

---

### 1.8 移动端浏览优化

> 前置依赖：1.7 Dashboard

- [ ] **P0** 全站响应式布局审查与调整
- [ ] **P0** 移动端行程详情页优化（地图与时间轴切换为上下堆叠布局）
- [ ] **P0** 移动端触摸交互优化（滑动、缩放手势）
- [ ] **P1** 移动端导航栏（底部 Tab Bar）
- [ ] **P2** PWA 基础配置（manifest.json、Service Worker 注册）

---

### 1.9 Phase 1 测试与验收

- [ ] **P0** 端到端流程测试：注册 → AI 生成行程 → 编辑 → 发布 → 浏览
- [ ] **P0** 移动端浏览体验测试（微信内置浏览器、Safari、Chrome）
- [ ] **P0** 安全基础测试（SQL 注入、XSS、CSRF）
- [ ] **P1** 性能基线测量（首屏加载时间、地图渲染速度）
- [ ] **P1** 数据备份策略确认

---
---

## Phase 2：社区互动 (The Interaction)

**阶段目标：** 粉丝可借鉴行程、提交纠错、接收动态预警，形成互动闭环

---

### 2.1 一键借鉴（Fork）系统

> 前置依赖：Phase 1 完成

- [ ] **P0** 数据库设计：行程派生关系表（fork_id、源行程id、派生行程id、派生时间）
- [ ] **P0** "以此为模板"按钮与后端接口（深拷贝行程数据为用户私有副本）
- [ ] **P0** 派生后的行程可自由编辑
- [ ] **P0** 行程详情页显示"派生自 @作者 的《行程名》"溯源信息
- [ ] **P1** 原行程页面显示"已被 N 人借鉴"统计

---

### 2.2 修改对比（Diff View）

> 前置依赖：2.1 Fork 系统

- [ ] **P0** 数据库设计：行程版本快照（JSON 形式存储每次发布时的完整状态）
- [ ] **P0** 对比算法：比较原行程与派生行程的差异（新增/删除/修改的节点）
- [ ] **P0** Diff View UI：高亮展示差异（绿色新增、红色删除、黄色修改）
- [ ] **P1** 支持逐节点查看差异详情

---

### 2.3 便捷纠错系统

> 前置依赖：Phase 1、2.1

- [ ] **P0** 数据库设计：纠错记录表（id、目标POI_id、纠错类型、纠错内容、提交者、状态[待审/已采纳/已驳回]、照片URL）
- [ ] **P0** 纠错快捷面板 UI：预设按钮（价格变了/关门了/时间变了/位置有误/其他）
- [ ] **P0** 点击按钮后动态展开对应输入项（如"现在价格：__ 元"）
- [ ] **P0** 照片上传组件（可选，压缩后上传）
- [ ] **P0** 纠错提交 API
- [ ] **P0** 照片 EXIF 信息剥离（自动移除精确 GPS 等敏感信息）
- [ ] **P1** 原作者收到纠错通知（站内信/推送）
- [ ] **P1** 纠错审核界面（原作者一键采纳/驳回）
- [ ] **P1** 采纳后自动更新 POI 数据
- [ ] **P1** 多人独立确认同一纠错时自动生效规则（≥3人确认）
- [ ] **P2** AI 辅助纠错：上传照片后 AI 识别价格/时间并预填表单

---

### 2.4 动态预警系统 (The Signal)

> 前置依赖：2.1 Fork 关系、2.3 纠错

- [ ] **P0** 数据库设计：通知表（id、接收者、类型[紧急/注意/参考]、内容、关联行程id、已读状态）
- [ ] **P0** 当原行程更新时，自动查询所有 Fork 且未标记"已出行"的用户
- [ ] **P0** 发送站内通知（预警卡片 UI）
- [ ] **P0** 预警分级显示：🔴紧急 / 🟡注意 / 🔵参考
- [ ] **P1** 通知中心页面（未读/已读、按时间排序）
- [ ] **P1** 用户标记行程"已出行"后不再接收该行程预警
- [ ] **P2** 邮件/短信推送（可选，紧急预警）

---

### 2.5 天气集成

> 前置依赖：1.5 时间轴编辑器

- [ ] **P1** 接入免费天气 API（如和风天气免费版）
- [ ] **P1** 时间轴顶部显示目的地对应日期的天气图标与温度
- [ ] **P2** 节假日/旺季自动提醒标签

---

### 2.6 多人协作

> 前置依赖：1.5 时间轴编辑器

- [ ] **P1** 生成协作分享链接（带 Token 的临时访问链接，无需注册）
- [ ] **P1** 后端 WebSocket 服务搭建（Socket.IO）
- [ ] **P1** 多人同时编辑时的实时同步（操作广播 + 冲突处理）
- [ ] **P1** 协作者光标/头像显示（标识"谁在编辑哪里"）
- [ ] **P2** 编辑历史记录（谁在什么时候改了什么）

---

### 2.7 一键导出/分享

> 前置依赖：1.7 行程详情页

- [ ] **P1** 行程导出为长图海报（服务端或前端 Canvas 渲染）
- [ ] **P1** 行程导出为 PDF 文档
- [ ] **P1** 生成微信分享卡片链接（无需注册即可查看的行程只读页）
- [ ] **P2** 分享页面 SEO 优化（Open Graph 标签）

---

### 2.8 Phase 2 测试与验收

- [ ] **P0** 端到端流程测试：浏览行程 → 借鉴 → 修改 → 查看对比 → 纠错 → 作者审核
- [ ] **P0** 预警通知流程测试：作者更新 → Fork 用户收到预警
- [ ] **P0** 纠错防滥用测试
- [ ] **P1** 多人协作并发编辑压力测试
- [ ] **P1** 导出内容质量审查（图片清晰度、PDF 排版）

---
---

## Phase 3：生态完善 (The Ecosystem)

**阶段目标：** 引入游戏化体系，激活社区自动维护数据

---

### 3.1 数字护照与徽章系统

> 前置依赖：Phase 2 完成

- [ ] **P0** 数据库设计：用户贡献记录表（贡献类型、时间、关联对象）
- [ ] **P0** 数据库设计：徽章定义表（id、名称、图标、获取条件描述、稀有度）
- [ ] **P0** 数据库设计：用户徽章表（用户id、徽章id、获取时间）
- [ ] **P0** 用户等级计算逻辑（基于贡献积分）
- [ ] **P0** 数字护照页面 UI："签证章"可视化展示
- [ ] **P0** 触发式徽章发放逻辑（如：首次纠错→"初心发现者"、纠错被采纳10次→"价格捕手"）
- [ ] **P1** 护照页面生成分享卡片（精美海报图，可分享到微信）
- [ ] **P1** 个人主页公开展示护照（可通过隐私设置关闭）
- [ ] **P2** 稀有徽章动效（闪光、旋转等微动画）

---

### 3.2 领地认领计划 (Territory Guardian)

> 前置依赖：3.1 贡献记录

- [ ] **P0** 数据库设计：领地区域表（id、名称、地理范围 PostGIS Polygon、守护者列表）
- [ ] **P0** 守护者申请流程（用户提交申请 → 管理员审核）
- [ ] **P0** 守护者审核权限：纠错数据优先审核
- [ ] **P0** 区域页面显示"本区域由 @用户X 维护"署名
- [ ] **P1** 活跃度自动检测：连续30天未活跃自动降级为"荣誉守护者"
- [ ] **P1** 信誉评分系统：审核准确率追踪，低于阈值暂停审核权
- [ ] **P1** 多守护者共同维护机制
- [ ] **P2** 守护者专属徽章与护照装饰

---

### 3.3 赏金任务 (Bounties)

> 前置依赖：3.1 徽章系统、1.3 POI 数据

- [ ] **P0** 赏金任务自动生成规则（POI 数据超过 N 天未更新 → 生成任务）
- [ ] **P0** 赏金任务列表页面
- [ ] **P0** 任务完成流程：到达附近 → GPS 校验 → 上传照片/数据 → 获得奖励
- [ ] **P0** GPS 位置验证逻辑（用户位置与 POI 坐标距离校验）
- [ ] **P1** 照片真实性基础检查（EXIF 时间戳、位置信息匹配）
- [ ] **P1** 新用户冷却期：注册后 N 天内限制赏金任务提交频率
- [ ] **P1** 高频提交自动触发人工审核
- [ ] **P1** 赏金任务附近推送（用户打开 App 时检测附近任务并提醒）
- [ ] **P2** 限时赏金任务（节假日特别任务）

---

### 3.4 探索广场增强

> 前置依赖：3.1 护照系统、Phase 2 数据积累

- [ ] **P1** 全景热力图：基于全站行程数据生成足迹热力覆盖层
- [ ] **P1** 趋势榜单：按"被借鉴次数"排名的行程列表
- [ ] **P1** 任务看板 (Bounty Board)：在 Dashboard 显示用户附近的赏金任务
- [ ] **P1** "有人去过"标签：行程卡片显示最近使用者的出行时间
- [ ] **P2** 智能推荐引擎：基于用户历史偏好推荐行程（美食型/打卡型/深度游）

---

### 3.5 离线模式 (PWA)

> 前置依赖：Phase 1 PWA 基础配置

- [ ] **P1** Service Worker 缓存策略（静态资源 + 已查看的行程数据）
- [ ] **P1** IndexedDB 本地存储离线行程数据
- [ ] **P1** "下载离线包"按钮：将行程的所有 POI、地图截图打包到本地
- [ ] **P1** 离线状态检测与 UI 提示（离线时显示横幅提醒）
- [ ] **P2** 离线时的基础地图瓦片缓存

---

### 3.6 用户隐私控制面板

> 前置依赖：1.2 用户系统

- [ ] **P1** 隐私设置页面 UI
- [ ] **P1** 位置权限控制（仅打卡时/允许推送任务/完全关闭）
- [ ] **P1** 行程默认可见性设置（公开/仅关注者/私有）
- [ ] **P1** 护照/徽章展示开关
- [ ] **P1** 一键导出个人数据（JSON 格式打包下载）
- [ ] **P0** 注销账号并删除所有数据功能

---

### 3.7 内容安全与合规

> 贯穿所有阶段，P3 集中完善

- [ ] **P1** 关键词过滤系统（敏感词库 + 自动拦截）
- [ ] **P1** 用户内容举报功能（举报按钮 + 管理后台审核）
- [ ] **P1** 管理后台：内容审核队列
- [ ] **P2** 自动图片审核（接入第三方内容安全 API 或基础规则）

---

### 3.8 Phase 3 测试与验收

- [ ] **P0** 护照与徽章完整流程测试：贡献 → 积分累积 → 徽章触发 → 护照展示
- [ ] **P0** 赏金任务流程测试：任务生成 → GPS 校验 → 提交 → 奖励发放
- [ ] **P0** 守护者流程测试：申请 → 审核 → 行使权限 → 活跃度降级
- [ ] **P0** 隐私功能测试：各控制项是否生效、数据导出完整性、注销彻底性
- [ ] **P1** 离线模式测试：断网后行程查看、恢复网络后数据同步
- [ ] **P1** 全站安全审计（XSS/CSRF/权限越界）
- [ ] **P1** 全站性能优化与压力测试

---
---

## 附录：技术栈速查表

| 层级 | 技术 | 用途 |
|---|---|---|
| 前端 | Vue 3 + Vite | SPA 框架 |
| UI 库 | Element Plus 或 Naive UI | 组件库 |
| 地图 | 高德地图 JS API | 地图渲染、POI搜索、路线规划 |
| 后端 | Flask 或 FastAPI | REST API 服务 |
| 数据库 | PostgreSQL + PostGIS | 关系数据 + 地理空间 |
| AI | DeepSeek API（主）/ Qwen（备） | 游记→结构化行程 |
| 实时通信 | Socket.IO | 多人协作、通知推送 |
| 离线 | PWA + Service Worker + IndexedDB | 离线访问 |
| 部署 | 本地服务器 + Cloudflare Tunnel | 初期部署方案 |
| 安全 | bcrypt + AES-256 + HTTPS | 数据加密与传输安全 |
