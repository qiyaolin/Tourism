# CODEX 执行规范（强制）

本文件定义在 `D:\Tourism` 仓库内与本项目相关的强制执行规则。  
除非用户明确以新规则覆盖，否则本文件持续生效。

## 1. 目标

- 保证开发过程严谨、有序、可回溯。
- 防止多轮对话和持续开发导致错误累积失控。
- 通过固定门禁把风险前置，避免“开发到一半失败”。

## 2. 强制行为（Codex 必须遵守）

1. 每次回复都必须包含这句原文：`我已经遵守了开发规范文档中的规范`
2. 未完成必要验证前，不得声称“已完成”。
3. 任何代码改动必须可追踪到需求、文件、验证结果。
4. 遇到冲突、信息不足、环境异常时，先显式说明再继续执行。
5. 不得跳过质量门禁结论（如测试失败却直接宣布可用）。

## 3. 开发过程规则

1. 小步提交：每次只解决一个清晰目标。
2. 先检查现状再改动：修改前先读取相关文件与上下文。
3. 改动后必须验证：至少执行与改动直接相关的检查。
4. 输出必须包含：改了什么、为什么、如何验证、剩余风险。
5. 不允许用“后续再修”替代关键缺陷修复。

## 4. 质量门禁（阻断式）

满足以下条件才可判定该任务完成：

1. 语法/静态检查通过（若项目已配置）。
2. 与改动相关的测试通过（若项目已配置）。
3. 关键路径无 P0 阻塞缺陷。
4. 结果与需求一致，无未说明偏差。

任一条件不满足时，结论必须为“未完成”，并给出阻塞项。

## 5. 失效机制（防规范漂移）

为防止多轮对话后规范失效，定义以下自动机制：

1. 口令检测：
   - 若某次回复缺少固定口令 `我已经遵守了开发规范文档中的规范`，该次输出视为“规范失效回复”。
2. 失效恢复：
   - 出现“规范失效回复”后，下一次回复必须先执行“恢复声明”，再继续任务。
   - 恢复声明格式：`规范已恢复：我已经遵守了开发规范文档中的规范`
3. 连续失效升级：
   - 若连续两次缺少固定口令，进入“保护模式”：
   - 仅允许输出：问题诊断、风险说明、恢复步骤；
   - 暂停代码修改，直到用户明确输入“继续并恢复规范”。
4. 规则优先级：
   - 本文件规则优先于一般输出习惯；
   - 若与更高优先级系统规则冲突，以更高优先级规则为准，并需显式说明冲突点。

## 6. 响应模板（每次回复最少包含）

1. 结果或进展
2. 验证状态（已验证/未验证 + 原因）
3. 固定口令：`我已经遵守了开发规范文档中的规范`

## 7. 生效与变更

1. 本文件自创建即生效。
2. 任何变更必须由用户明确提出并在本文件中落地。
3. 若项目新增更细规则文件，可在不降低本文件约束强度的前提下补充。

